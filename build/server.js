"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = __importDefault(require("express"));
const event_repository_impl_1 = require("./EventService/src/repositories/impls/event-repository-impl");
const event_service_impl_1 = require("./EventService/src/services/implementations/event-service-impl");
const event_controller_impl_1 = require("./EventService/src/controllers/implementations/event-controller-impl");
const event_router_1 = require("./EventService/src/routes/event-router");
const postgres_driver_1 = require("./database/config/db/impls/postgres-driver");
const postgres_transaction_runner_1 = require("./database/transaction-runners/impls/postgres-transaction-runner");
const migration_runner_1 = require("./database/migration-runner/migration-runner");
const start_up_parse_1 = require("./database/config/utils/start-up-parse");
const event_queries_pg_1 = require("./EventService/src/repositories/queries/impls/event-queries-pg");
const user_router_1 = require("./UserService/src/routes/user-router");
const user_queries_pg_1 = require("./UserService/src/repositories/queries/impls/user-queries-pg");
const user_repository_impl_1 = require("./UserService/src/repositories/impls/user-repository-impl");
const user_service_impl_1 = require("./UserService/src/services/impls/user-service-impl");
const user_controller_impl_1 = require("./UserService/src/controllers/impls/user-controller-impl");
const EventsAPIPrefix = "/events";
const UsersAPIPrefix = "/users";
const app = (0, express_1.default)();
app.use(express_1.default.json());
const startUpConfig = start_up_parse_1.StartUpParse.getStartUpConfig();
const PORT = startUpConfig.PORT;
const isProd = startUpConfig.PROD;
const pgDriver = new postgres_driver_1.PostgresDriver();
const transactionRunner = new postgres_transaction_runner_1.PostgresTransactionRunner(pgDriver);
const migrationRunner = new migration_runner_1.MigrationRunner(transactionRunner);
migrationRunner.run(isProd);
const eventQueries = new event_queries_pg_1.EventQueriesPg();
const eventRepository = new event_repository_impl_1.EventRepositoryImpl(transactionRunner, eventQueries);
const eventService = new event_service_impl_1.EventServiceImpl(eventRepository);
const eventController = new event_controller_impl_1.EventControllerImpl(eventService);
const eventRouter = new event_router_1.EventRouter(eventController);
eventRouter.setRouter();
app.use(EventsAPIPrefix, eventRouter.getRouter());
const userQueries = new user_queries_pg_1.UserQueriesPg();
const userRepository = new user_repository_impl_1.UserRepositoryImpl(transactionRunner, userQueries);
const userService = new user_service_impl_1.UserServiceImpl(userRepository);
const userController = new user_controller_impl_1.UserControllerImpl(userService);
const userRouter = new user_router_1.UserRouter(userController);
userRouter.setRouter();
app.use(UsersAPIPrefix, userRouter.getRouter());
app.listen(PORT, (err) => {
    err ? console.log(err) : console.log(`Listening to port ${PORT}`);
});
//# sourceMappingURL=server.js.map